<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <link rel="icon" href="%PUBLIC_URL%/favicon.ico" id="favicon" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
    <meta name="theme-color" content="#000000" />
    <meta
      name="description"
      content="Food Tracker - Track your meals, workouts, and nutrition goals"
    />
    <link rel="apple-touch-icon" href="%PUBLIC_URL%/logo192.png" />
    <link rel="manifest" href="%PUBLIC_URL%/manifest.json" />
    <title>Food Tracker</title>
    
    <!-- Firebase Analytics Debug Mode -->
    <script>
      // Enable debug mode for Analytics by checking URL parameter or localStorage
      // Usage: Add ?debug_analytics=true to URL, or run in console: localStorage.setItem('debug_analytics', 'true')
      const urlParams = new URLSearchParams(window.location.search);
      const debugParam = urlParams.get('debug_analytics');
      const debugStored = localStorage.getItem('debug_analytics');
      
      if (debugParam === 'true' || debugStored === 'true') {
        console.log('üîç Firebase Analytics Debug Mode: ENABLED');
        console.log('üìä View real-time events: https://console.firebase.google.com ‚Üí Analytics ‚Üí DebugView');
        
        // Store preference
        if (debugParam === 'true') {
          localStorage.setItem('debug_analytics', 'true');
        }
        
        // Enable debug mode by setting gtag parameters
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-S5KEEtHYC2', {
          'debug_mode': true
        });
      } else if (debugParam === 'false') {
        // Disable debug mode
        localStorage.removeItem('debug_analytics');
        console.log('üîç Firebase Analytics Debug Mode: DISABLED');
      }
    </script>
    
    <script>
      // Cache busting and service worker management
      (function() {
        var APP_VERSION = 'v2025-11-23-mobile-nav-fix'; // Match service worker version
        
        // Check stored version
        var storedVersion = localStorage.getItem('app_version');
        if (storedVersion && storedVersion !== APP_VERSION) {
          console.log('[Cache] Version mismatch detected! Clearing cache...');
          console.log('[Cache] Old:', storedVersion, '‚Üí New:', APP_VERSION);
          
          // Clear everything
          if ('caches' in window) {
            caches.keys().then(function(names) {
              names.forEach(function(name) {
                console.log('[Cache] Deleting cache:', name);
                caches.delete(name);
              });
            });
          }
          if ('serviceWorker' in navigator) {
            navigator.serviceWorker.getRegistrations().then(function(registrations) {
              registrations.forEach(function(registration) {
                console.log('[Cache] Unregistering SW:', registration.scope);
                registration.unregister();
              });
            });
          }
          
          // Update version
          localStorage.setItem('app_version', APP_VERSION);
          
          // Force hard reload
          console.log('[Cache] Forcing hard reload...');
          setTimeout(function() {
            window.location.reload(true);
          }, 500);
          return;
        }
        
        // Store current version if not set
        if (!storedVersion) {
          localStorage.setItem('app_version', APP_VERSION);
        }
        
        // Check for force refresh parameter
        var urlParams = new URLSearchParams(window.location.search);
        if (urlParams.get('clear-cache') === 'true') {
          console.log('[Cache] Manual clear requested...');
          if ('caches' in window) {
            caches.keys().then(function(names) {
              names.forEach(function(name) {
                caches.delete(name);
              });
            });
          }
          if ('serviceWorker' in navigator) {
            navigator.serviceWorker.getRegistrations().then(function(registrations) {
              registrations.forEach(function(registration) {
                registration.unregister();
              });
            });
          }
          // Remove the parameter and reload
          urlParams.delete('clear-cache');
          var newUrl = window.location.pathname + (urlParams.toString() ? '?' + urlParams.toString() : '');
          window.history.replaceState({}, '', newUrl);
          setTimeout(function() {
            window.location.reload(true);
          }, 500);
        }

        // Dynamically set favicon based on environment
        var favicon = document.getElementById('favicon');
        var isLocalhost = window.location.hostname === 'localhost' || 
                         window.location.hostname === '127.0.0.1' ||
                         window.location.hostname === '';
        
        if (favicon) {
          if (isLocalhost) {
            // Create a simple orange favicon for development
            var canvas = document.createElement('canvas');
            canvas.width = 16;
            canvas.height = 16;
            var ctx = canvas.getContext('2d');
            ctx.fillStyle = '#ff6b35'; // Orange color for dev
            ctx.fillRect(0, 0, 16, 16);
            ctx.fillStyle = '#ffffff';
            ctx.font = 'bold 10px Arial';
            ctx.textAlign = 'center';
            ctx.fillText('D', 8, 12);
            favicon.href = canvas.toDataURL('image/png');
            document.title = 'üçé Food Tracker (DEV)';
          } else {
            // Create a simple green favicon for production
            var canvas = document.createElement('canvas');
            canvas.width = 16;
            canvas.height = 16;
            var ctx = canvas.getContext('2d');
            ctx.fillStyle = '#4caf50'; // Green color for prod
            ctx.fillRect(0, 0, 16, 16);
            ctx.fillStyle = '#ffffff';
            ctx.font = 'bold 10px Arial';
            ctx.textAlign = 'center';
            ctx.fillText('F', 8, 12);
            favicon.href = canvas.toDataURL('image/png');
            document.title = 'üçΩÔ∏è Food Tracker';
          }
        }
      })();
    </script>
  </head>
  <body>
    <noscript>You need to enable JavaScript to run this app.</noscript>
    <div id="root"></div>
    <!--
      This HTML file is a template.
      If you open it directly in the browser, you will see an empty page.

      You can add webfonts, meta tags, or analytics to this file.
      The build step will place the bundled scripts into the <body> tag.

      To begin the development, run `npm start` or `yarn start`.
      To create a production bundle, use `npm run build` or `yarn build`.
    -->
  </body>
</html>
